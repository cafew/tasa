#!/bin/bash -e
pushd "$(dirname $0)/tasa"

# Run regression tests
rake

# Compile assets
RAILS_ENV=production rake compile

popd

# Upload files to server
rsync -avz -e ssh ~/workspace/nlpdemo pivot@10.64.7.2:code

# Restart Django server
ssh pivot@10.64.7.2 <<BASH
killall -u pivot python
cd ~/code/nlpdemo
source activate py2.7
./start_dev_server </dev/null &>~/log.txt &
BASH